<?xml version="1.0" encoding="ISO-8859-1"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" />
    <meta http-equiv="Content-Language" content="en" />
    <title>How to cross-compile skalibs: Dan Kegel's hints for making sysdeps</title>
    <meta name="Description" content="How to cross-compile skalibs: Dan Kegel's hints for making sysdeps" />
    <meta name="Keywords" content="skalibs build cross-compiling compilation sysdeps notes hints Dan Kegel" />
    <!-- <link rel="stylesheet" type="text/css" href="http://www.skarnet.org/default.css" /> -->
  </head>
<body>

<p>
<a href="index.html">skalibs</a><br />
<a href="../index.html">Software</a><br />
<a href="../../index.html">www.skarnet.org</a>
</p>

<h1> <a href="http://www.kegel.com/">Dan Kegel</a>'s hints on making
sysdeps files for skalibs cross-compilation </h1>

<p>
 Here is what he said (edited for typos) from his experience.
I commented some points.
</p>
<p>
 <em>
  (Note: the build system changed in skalibs-1.0.0, so these notes are outdated;
they're available only for reference.)
 </em>
</p>

<pre>
    If your target is an embedded system with a shell and normal Unix
    utilities, but no make and no compiler, you may still be able to run
    parts of the configuration scripts on the target system, and combine
    their output with one of the preconfigured sysdeps that is a close match.

    You should read and understand the configuration scripts.  One
    way to get a handle on them is to add 'set -x' to the top of
    all the scripts in skalibs
</pre>

<p>
<em>(In the <tt>package</tt> directory.)</em>
</p>

<pre>
    then configure on your workstation,
    save the log, and look through it (or use it as a reference).
    This will show you the sequence in which the scripts are run,
    and expose steps that might not have been obvious by inspection.

    The file sysdeps is created by src/sysdeps/Makefile like this:
         cat systype compile load socket.lib util.lib > sysdeps
         grep -h sysdep: sysdeps.h >> sysdeps

    That first file, systype, is generated by src/systype/find-systype.sh,
    which can be transferred by itself to the target and run standalone on
    non-x86 systems.
</pre>

<p>
<em>This is not completely true: in some cases, <tt>find-systype.sh</tt>
depends on <tt>bootcompile</tt> and <tt>bootload</tt>, which are
generated exactly as <tt>compile</tt> and <tt>load</tt> are. Nevertheless,
the information is not really vital, so you may perform as suggested
without losing too much accuracy.</em>
</p>

<pre>
    The second file, compile, is generated by src/sys/Makefile,
    it contains the first line of your conf-cc followed by -c "$1"
    (followed by a call to strip on some operating systems, but that can
    be omitted).
</pre>

<p>
<em>Update: starting with 0.27, object files are not stripped. <tt>conf-stripbins</tt>
and <tt>conf-striplibs</tt> are used in building the <tt>load</tt> and <tt>makelib</tt>
respectively, to strip executables or libraries at link time / archive time;
but you can safely have blank <tt>conf-stripbins</tt> and <tt>conf-striplibs</tt>
files, and ignore stripping completely. </em>
</p>

<pre>
    The third file, load, is generated by src/sys/print-ld.sh, which
    can safely be run on the development system; it doesn't need to be
    transferred. It reads your conf-ld file, and generates the line
    skalibs actually uses to link programs.

    The fourth and fifth files, socket.lib and util.lib, can be left empty
    or unchanged until you notice your programs need -lutil or something
    like that to link :-)

    The last file, sysdeps.h, you should probably copy from a preconfigured
    sysdeps directory, and edit by hand.  Obvious entries to change might
    be HASLITTLE_ENDIAN and HASBIG_ENDIAN.

    Once you've done all that, concatenate them to form sysdeps as
    src/sysdeps/Makefile would have done.
</pre>

<p>
<em>Thank you for writing documentation in my place, Dan. :-)</em>
</p>

</body>
</html>
